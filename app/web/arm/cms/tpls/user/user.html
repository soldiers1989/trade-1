
<div class="easyui-layout" data-options="fit:true, split:true, border: true">
    <div data-options="region:'west', split:true" style="width: 75%;">
        <table id="user_datagrid" style="height: 100%;"></table>
    </div>
    <div data-options="region:'center', split:true" style="width: 25%">
        <div class="easyui-tabs" id="user_detail_tabs" fit="true" border="true" plain="true">
            <div title="基本信息">
                <div class="easyui-panel" style="height:50%;">
                    <table id="user_info_datagrid"></table>
                </div>
                <div class="easyui-panel" title="银行账户" style="height:50%;">
                    <table id="user_bank_datagrid"></table>
                </div>
            </div>
            <div title="用户交易">
                <table id="user_trade_datagrid"></table>
            </div>
            <div title="充值提现">
                <div class="easyui-panel" title="充值记录" style="height:50%;">
                    <table id="user_charge_datagrid"></table>
                </div>
                <div class="easyui-panel" title="提现记录" style="height:50%;">
                    <table id="user_draw_datagrid"></table>
                </div>
            </div>
            <div title="资金流水">
                <table id="user_bill_datagrid"></table>
            </div>
            <div title="优惠券">
                <table id="user_coupon_datagrid"></table>
            </div>
            <div title="自选股票">
                <table id="user_stock_datagrid"></table>
            </div>
        </div>
    </div>
</div>

<div id="user_toolbar">
    <span>
        <a href="javascript:void(0)" id="user_edit_menubutton" class="easyui-menubutton" data-options="menu:'#user_edit_menus',iconCls:'icon-edit'">编辑</a>
        <div id="user_edit_menus" style="width:150px;">
            <div>重置密码</div>
        </div>
    </span>
    <span style="float: right; margin-right: 18px;">
        <form class="easyui-form" id="user_search_form">
            <span>日期</span>
            <input id="sdate" class="easyui-datebox" validType="date">
            <span>-</span>
            <input id="edate" class="easyui-datebox" validType="date">

            <input id="words" class="easyui-textbox">

            <a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="user.search.do()">查询</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-reload" onclick="user.search.reset()">重置</a>
        </form>
    </span>
</div>


<script type="text/javascript">
    // user list/add/update/delete
    var user = {
        //user search
        search: {
            form: $('#user_search_form'),

            do: function() { // do search
                //check search form
                if(!this.form.form('validate'))
                    return;

                //get parameters
                params = {
                    sdate: this.form.children('#sdate').val(),
                    edate: this.form.children('#edate').val(),
                    words: this.form.children('#words').val()
                };

                //reload by retrieve conditions
                user.list.load(params);
            },

            reset: function() { // reset
                //clear form
                this.form.form('clear');

                //reload datagrid
                user.list.load({});
            },
        },

        //trade list
        list: {
            url: '/api/user/user/list',
            datagrid: $('#user_datagrid'),

            init: function() {
                this.datagrid.datagrid({
                    url: this.url,
                    method: 'post',
                    
                    idField: 'id',
            
                    striped: true,
                    fitColumns: true,
                    pagination: true,
                    rownumbers: false,
                    singleSelect: true,

                    pageNumber: 1,
                    pageSize: 20,
                    pageList: [5, 10, 20, 30, 40, 50, 100],
                    
                    toolbar: '#user_toolbar',
                     columns: [[
                        {field:'id', title:'ID', sortable:true},
                        {field:'user', title:'用户', sortable:true},
                        {field:'phone', title:'手机', sortable:true},
                        {field:'money', title:'余额', sortable:true},
                        {field:'disable', title:'状态', sortable:true, formatter: cube.format.boolean},
                        {field:'ctime', title:'注册时间', sortable:true, formatter: cube.format.datetime},
                        {field:'ltime', title:'最近访问', sortable:true, formatter: cube.format.datetime}
                    ]],

                    loadFilter: function (resp) {
                        return resp.data;
                    },

                    onLoadSuccess: function(resp) {
                    },

                    onLoadError: function() {
                        $.messager.show({title: '错误', msg: '请求用户列表数据失败'});
                    },
                    
                    onSelect(index, row) {
                        user.detail.show(row.id);
                    }
                });
            },

            load: function(params) {
                this.datagrid.datagrid('load', params);
            }
        },

        //trade detail
        detail: {
            lever: {
                url: '/api/trade/order/lever',
                datagrid: $('#order_lever_datagrid'),

                inited: false,

                init: function(params) {
                    this.datagrid.datagrid({
                        url: this.url,
                        method: 'post',
                        queryParams: params,
                        
                        idField: 'name',
                
                        striped: true,
                        fitColumns: true,
                        pagination: false,
                        rownumbers: false,
                        singleSelect: true,

                        columns: [[
                            {field:'name', title:'名称', width:'50%'},
                            {field:'value', title:'取值', width:'50%'}
                        ]],

                        loadFilter: function (resp) {
                            return resp.data;
                        },

                        onLoadSuccess: function(resp) {
                        },

                        onLoadError: function() {
                            $.messager.show({title: '错误', msg: '请求交易杠杆详情失败'});
                        }
                    });

                    this.inited=true;
                },
                
                load: function(params) {
                    this.datagrid.datagrid('load', params);
                },

                show: function(tradeid) {
                    params = {id:tradeid};
                    if(!this.inited)
                        this.init(params);
                    else
                        this.load(params);
                }
            },

            fees: {
                url: '/api/trade/order/fees',
                datagrid: $('#order_fee_datagrid'),

                inited: false,

                init: function(params) {
                    this.datagrid.datagrid({
                        url: this.url,
                        method: 'post',
                        queryParams: params,
                        
                        idField: 'id',
                
                        striped: true,
                        fitColumns: true,
                        pagination: false,
                        rownumbers: false,
                        singleSelect: true,

                        columns: [[
                            {field:'item', title:'类目', width:'20%'},
                            {field:'nmoney', title:'应收', width:'20%'},
                            {field:'amoney', title:'实收', width:'20%'},
                            {field:'ctime', title:'时间', formatter: cube.format.datetime}
                        ]],

                        loadFilter: function (resp) {
                            return resp.data;
                        },

                        onLoadSuccess: function(resp) {
                        },

                        onLoadError: function() {
                            $.messager.show({title: '错误', msg: '请求交易费用详情失败'});
                        }
                    });

                    this.inited=true;
                },
                
                load: function(params) {
                    this.datagrid.datagrid('load', params);
                },

                show: function(tradeid) {
                    params = {id:tradeid};
                    if(!this.inited)
                        this.init(params);
                    else
                        this.load(params);
                }
            },

            margins: {
                url: '/api/trade/order/margins',
                datagrid: $('#order_margin_datagrid'),
                
                inited: false,

                init: function(params) {
                   this.datagrid.datagrid({
                        url: this.url,
                        method: 'post',
                        queryParams: params,
                        
                        idField: 'id',
                
                        striped: true,
                        fitColumns: true,
                        pagination: false,
                        rownumbers: true,
                        singleSelect: true,

                        columns: [[
                            {field:'item', title:'类目', width:'25%'},
                            {field:'money', title:'金额', width:'30%'},
                            {field:'ctime', title:'时间', formatter: cube.format.datetime}
                        ]],

                        loadFilter: function (resp) {
                            return resp.data;
                        },

                        onLoadSuccess: function(resp) {
                        },

                        onLoadError: function() {
                            $.messager.show({title: '错误', msg: '请求交易保证金详情失败'});
                        }
                    });

                   this.inited = true;
                },

                load: function(params) {
                    this.datagrid.datagrid('load', params);
                },

                show: function(tradeid) {
                    params = {id:tradeid};
                    if(!this.inited)
                        this.init(params);
                    else
                        this.load(params);
                }
            },

            orders: {
                url: '/api/trade/order/orders',
                datagrid: $('#order_order_datagrid'),
                
                inited: false,
                
                init: function(params) {
                   this.datagrid.datagrid({
                        url: this.url,
                        method: 'post',
                        queryParams: params,
                        
                        idField: 'id',
                
                        striped: true,
                        fitColumns: true,
                        pagination: false,
                        rownumbers: true,
                        singleSelect: true,

                        columns: [[
                            {field:'status', title:'处理状态'},
                            {field:'ostatus', title:'委托状态'},
                            {field:'account', title:'股票账户'},
                            {field:'otype', title:'委托类别'},
                            {field:'ptype', title:'报价方式'},
                            {field:'ocount', title:'委托数量'},
                            {field:'oprice', title:'委托价格'},
                            {field:'ocode', title:'委托编号'},
                            {field:'otime', title:'委托时间'},
                            {field:'dcount', title:'成交数量'},
                            {field:'dprice', title:'成交价格'},
                            {field:'dtime', title:'成交时间'},
                        ]],

                        loadFilter: function (resp) {
                            return resp.data;
                        },

                        onLoadSuccess: function(resp) {
                        },

                        onLoadError: function() {
                            $.messager.show({title: '错误', msg: '请求交易委托详情失败'});
                        }
                    });

                   this.inited = true;
                },

                load: function(params) {
                    this.datagrid.datagrid('load', params);
                },

                show: function(tradeid) {
                    params = {id:tradeid};
                    if(!this.inited)
                        this.init(params);
                    else
                        this.load(params);
                }
            },

            show: function(tradeid) {
                this.lever.show(tradeid);
                this.fees.show(tradeid);
                this.margins.show(tradeid);
                this.orders.show(tradeid);
            }
        },

        //init user trade
        init: function() {
            // init user trade list
            this.list.init();
        }
    };

    //init page
    $(function(){
        //init user page
        user.init();
    });

</script>
